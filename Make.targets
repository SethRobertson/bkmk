# $Id: Make.targets,v 1.2 2001/06/18 19:29:32 seth Exp $
#
# ++Copyright LIBBK++
#
# Copyright (c) 2001 The Authors.  All rights reserved.
#
# This source code is licensed to you under the terms of the file
# LICENSE.TXT in this release for further details.
#
# Mail <projectbaka@baka.org> for further information
#
# --Copyright LIBBK--
#
#
# Target rules--things people might want
#

#
# Sub-directory rule
#
ifeq ($(strip $(BK_SUBDIR)),)
BK_SUBDIRRULE= # No sub-directories
else # BK_SUBDIR
BK_SUBDIRRULE=@BK_SUBDIR="${BK_SUBDIR}"; if [ -n "$$BK_SUBDIR" ]; then for d in $$BK_SUBDIR; do (cd $$d && $(MAKE) $(MAKEFLAGS) $@) || exit $$?; done; fi
endif # BK_SUBDIR


#
# Default rule--standard target to compile everything
#
default:: $(BK_LOCALTARGETS) $(BK_GROUPTARGETS) $(BK_PACKAGETARGETS) $(BK_SIMPLE_PROGS) $(BK_LARGE_PROG) $(BK_LARGE_LIB)
	$(BK_SUBDIRRULE)	


#
# Get rid of stuff including stuff that might be valuable (e.g. autosave files, etc)
#
nuke::
	$(RRM) -- $(BK_NUKESTUFF)
	$(BK_SUBDIRRULE)	


#
# Get rid of stuff that can be regenerated or is just stupid, including .depend files
#
clean::
	$(RRM) -- $(BK_CLEANSTUFF)
	$(BK_SUBDIRRULE)	


#
# Get rid of stuff that can be regenerated or is just stupid, excluding .depend files
#
neat::
	$(RRM) -- $(BK_NEATSTUFF)
	$(BK_SUBDIRRULE)	


#
# Preprocess
#
preprocess:: $(BK_SIMPLE_CSRC) $(BK_LARGE_CSRC) $(BK_LARGE_LIBCSRC) $(BK_LOCAL_CSRC)
preprocess:: $(patsubst %.c,%.i,$(BK_SIMPLE_CSRC) $(BK_LARGE_CSRC) $(BK_LARGE_LIBCSRC) $(BK_LOCAL_CSRC))


#
# Dependency generation
#
nukedepend::
	> .depend

depend:: nukedepend

depend:: $(BK_SIMPLE_CSRC) $(BK_LARGE_CSRC) $(BK_LARGE_LIBCSRC) $(BK_LOCAL_CSRC) $(BK_LOCAL_OTHERDEPS)
	$(MKDEP) $^ >> .depend
	$(BK_SUBDIRRULE)


#
# Multi-architecture support
#
ifneq ($(strip $(PKGSUBDIR)),)
build::
	-d=BUILD/$(BK_ARCHNAME); (ls ./Make*; find $(BK_SUBDIR) -name Make\* -print) | while read f; do mkdir -p $$d/`dirname $$f`; ln -s `pwd`/$$f $$d/$$f; done
	@echo "To compile: cd BUILD/$(BK_ARCHNAME) and type make"
endif


#
# Installation support
#
install:: $(BK_SIMPLE_PROGS) $(BK_LARGE_PROG) $(BK_LARGE_LIB) $(BK_DATAFILES) $(BK_MAN)
ifneq ($(strip $(BK_INSTALLPROGDIR)),)
ifneq ($(strip $(BK_SIMPLE_PROGS)),)
	$(INSTALL) $(INSTALL_BINFLAGS) $(BK_SIMPLE_PROGS) $(BK_INSTALLPROGDIR)
endif # BK_SIMPLE_PROGS
ifneq ($(strip $(BK_LARGE_PROG)),)
	$(INSTALL) $(INSTALL_BINFLAGS) $(BK_LARGE_PROG) $(BK_INSTALLPROGDIR)
endif # BK_LARGE_PROG
endif # BK_INSTALLPROGDIR
ifneq ($(strip $(BK_INSTALLLIBDIR)),)
ifneq ($(strip $(BK_LARGE_LIB)),)
	$(INSTALL) $(INSTALL_OTHERFLAGS) $(BK_LARGE_LIB) $(BK_INSTALLLIBDIR)
	$(RANLIB) $@
endif # BK_LARGE_LIB
endif # BK_INSTALLLIBDIR
ifneq ($(strip $(BK_INSTALLDATADIR)),)
ifneq ($(strip $(BK_DATAFILES)),)
	$(INSTALL) $(INSTALL_OTHERFLAGS) $(BK_DATAFILES) $(BK_INSTALLDATADIR)
endif # BK_DATAFILES
endif # BK_INSTALLDATADIR
ifneq ($(strip $(BK_INSTALLMANDIR)),)
ifneq ($(strip $(BK_MAN)),)
_BK_MAN1:=$(filter %.1,$(BK_MAN))
_BK_MAN3:=$(filter %.3,$(BK_MAN))
_BK_MAN5:=$(filter %.5,$(BK_MAN))
_BK_MAN8:=$(filter %.8,$(BK_MAN))
ifneq ($(strip $(_BK_MAN1)),)
	$(INSTALL) $(INSTALL_OTHERFLAGS) $(_BK_MAN1) $(BK_INSTALLMANDIR)/man1
endif # _BK_MAN1
ifneq ($(strip $(_BK_MAN3)),)
	$(INSTALL) $(INSTALL_OTHERFLAGS) $(_BK_MAN3) $(BK_INSTALLMANDIR)/man3
endif # _BK_MAN3
ifneq ($(strip $(_BK_MAN5)),)
	$(INSTALL) $(INSTALL_OTHERFLAGS) $(_BK_MAN5) $(BK_INSTALLMANDIR)/man5
endif # _BK_MAN5
ifneq ($(strip $(_BK_MAN8)),)
	$(INSTALL) $(INSTALL_OTHERFLAGS) $(_BK_MAN8) $(BK_INSTALLMANDIR)/man8
endif # _BK_MAN8
endif # BK_MAN
endif # BK_INSTALLMANDIR
	$(BK_SUBDIRRULE)


#
# Tags support
#
nukeetags::
	> TAGS

nukectags::
	> tags

etags:: nukeetags
	$(MAKE) $(MAKEFLAGS) TAGCMD=$(ETAGS) TAGOUT=$(CURDIR)/TAGS subtags

ctags:: nukectags
	$(MAKE) $(MAKEFLAGS) TAGCMD=$(CTAGS) TAGOUT=$(CURDIR)/tags subtags

tags:: etags

subtags:: $(BK_SIMPLE_CSRC) $(BK_LARGE_CSRC) $(BK_LARGE_LIBCSRC) $(BK_LOCAL_CSRC) $(BK_LOCAL_OTHERTAGS)
	$(TAGCMD) -a -o $(TAGOUT) $^
	$(BK_SUBDIRRULE)


#
# Prevent targets from being files
#
.PHONY : default nuke clean neat depend nukedepend build install nukeetags nukectags etags ctags tags subtags preprocess
